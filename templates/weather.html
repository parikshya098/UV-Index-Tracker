{% extends "base.html" %}

{% block content %}
<h2>UV Index Forecast for {{ weather_info.city | safe }}</h2>

<!-- Display forecast details -->
<div class="current-weather">
    <p><strong>City / Zip Code:</strong> {{ weather_info.city | safe }}</p>
    <p><strong>Latitude:</strong> {{ weather_info.latitude }}</p>
    <p><strong>Longitude:</strong> {{ weather_info.longitude }}</p>
    <p><strong>From Date:</strong> {{ weather_info.from_date }}</p>
    <p><strong>To Date:</strong> {{ weather_info.to_date }}</p>
    <div class="section-box education">
        <p><strong>Current UV Index</strong> 
            {% if weather_info.uv_index is not none %}
                {% if weather_info.uv_index <= 2 %}
                    <strong>(Low)</strong> - 
                {% elif weather_info.uv_index <= 5 %}
                    <strong>(Moderate)</strong> - 
                {% elif weather_info.uv_index <= 7 %}
                    <strong>(High)</strong> - 
                {% elif weather_info.uv_index <= 10 %}
                    <strong>(Very High)</strong> - 
                {% else %}
                    <strong>(Extreme)</strong> - 
                {% endif %}
                <span style="color: 
                    {% if weather_info.uv_index <= 2 %}green
                    {% elif weather_info.uv_index <= 5 %}yellow
                    {% elif weather_info.uv_index <= 7 %}orange
                    {% elif weather_info.uv_index <= 10 %}red
                    {% else %}purple{% endif %}
                ">
                    {{ weather_info.uv_index }}
                </span>
            {% else %}
                <span>No UV index data available</span>
            {% endif %}
        </p>      
    </div>

</div>

<!-- UV Index Chart -->
<div class="chart-container">
    <canvas id="uvChart"></canvas>
</div>

<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const uvData = {{ uv_data | tojson | safe }};
    const timeData = {{ time_data | tojson | safe }};

    console.log("UV Data:", uvData);
    console.log("Time Data:", timeData);

    const canvas = document.getElementById('uvChart');
    if (canvas) {
        const ctx = canvas.getContext('2d');

        // Check if data is available
        if (Array.isArray(uvData) && uvData.length > 0 && Array.isArray(timeData) && timeData.length > 0) {
            // Convert time data to more readable format
            const formattedTimeData = timeData.map(time => new Date(time).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));

            console.log("Formatted Time Data:", formattedTimeData);

            // Create the chart
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: formattedTimeData,
                    datasets: [{
                        label: 'UV Index',
                        data: uvData,
                        borderColor: '#FF5733',
                        backgroundColor: 'rgba(255, 87, 51, 0.2)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: uvData.map(value => {
                            if (value <= 2) return 'green';
                            if (value <= 5) return 'yellow';
                            if (value <= 7) return 'orange';
                            if (value <= 10) return 'red';
                            return 'purple';
                        }),
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'UV Index'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Time (Hourly)'
                            }
                        }
                    }
                }
            });
        } else {
            console.error("Chart data is missing or incomplete");
        }
    } else {
        console.error("Canvas element not found");
    }
</script>
{% endblock %}